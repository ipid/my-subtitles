[Script Info]
; Script generated by Aegisub 9530-cibuilds-79a0655eb
; http://www.aegisub.org/
Title: Default Aegisub file
ScriptType: v4.00+
WrapStyle: 0
ScaledBorderAndShadow: yes
YCbCr Matrix: None
PlayResX: 1920
PlayResY: 1080

[Aegisub Project Garbage]
Last Style Storage: ipid-我的样式-v3-双描边
Video File: ?dummy:30.000000:300:1920:1080:154:154:154:
Video AR Value: 1.777778
Video Zoom Percent: 0.500000
Active Line: 3

[V4+ Styles]
Format: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding
Style: 虹-爱-奈酱-furigana,方正FW筑紫A圆 简 E,46,&H000058FF,&H000058FF,&H00FFFFFF,&H008D8DFF,0,0,0,0,100,100,0,0,1,4.5,4,2,10,10,70,1
Style: 虹-步梦-阿兔嘭-furigana,方正FW筑紫A圆 简 E,46,&H008A53FC,&H008A53FC,&H00FFFFFF,&H009994FF,0,0,0,0,100,100,0,0,1,4.5,4,2,10,10,70,1
Style: 虹-栞子-萌P-furigana,方正FW筑紫A圆 简 E,46,&H007DAB34,&H006FA51D,&H00FFFFFF,&H0083CD70,0,0,0,0,100,100,0,0,1,4.5,4,2,10,10,70,1
Style: 虹-果林-miyu碳-furigana,方正FW筑紫A圆 简 E,46,&H00C65E48,&H00C65E48,&H00FFFFFF,&H00FAA275,0,0,0,0,100,100,0,0,1,4.5,4,2,10,10,70,1
Style: 虹-岚珠-菜宝-furigana,方正FW筑紫A圆 简 E,46,&H00656DFF,&H00737AFE,&H00FFFFFF,&H00B8B7EE,0,0,0,0,100,100,0,0,1,4.5,4,2,10,10,60,1
Style: Default-furigana,Arial,24,&H00FFFFFF,&H000000FF,&H00000000,&H00000000,0,0,0,0,100,100,0,0,1,1,1,2,10,10,10,1
Style: 全局阴影-furigana,方正FW筑紫A圆 简 E,46,&H00FFFFFF,&H00FFFFFF,&H00FFFFFF,&H96727272,0,0,0,0,100,100,0,0,1,4.5,6.5,2,10,10,70,1
Style: 星-米女芽衣-薮岛朱音-furigana,方正FW筑紫A圆 简 E,46,&H003535FF,&H003535FF,&H00FFFFFF,&H207677FF,0,0,0,0,100,100,0,0,1,4.5,4,2,10,10,70,1
Style: 星-樱小路希奈子-铃原希实-furigana,方正FW筑紫A圆 简 E,46,&H00009FD4,&H000E95C1,&H00FFFFFF,&H0054C4D5,0,0,0,0,100,100,0,0,1,4.5,4,2,10,10,70,1
Style: 星-恋-渚-furigana,方正FW筑紫A圆 简 E,46,&H00B9110A,&H00B62E21,&H00FFFFFF,&H00D26765,0,0,0,0,100,100,0,0,1,4.5,4,2,10,10,70,1
Style: 星-堇-Pay-furigana,方正FW筑紫A圆 简 E,46,&H0000AB39,&H001EAA4D,&H00FFFFFF,&H5093FF9E,0,0,0,0,100,100,0,0,1,4.5,4,2,10,10,70,1
Style: 星-可可-鲤鱼-furigana,方正FW筑紫A圆 简 E,46,&H009CA601,&H00A1AC08,&H00FFFFFF,&H50EBF793,0,0,0,0,100,100,0,0,1,4.5,4,2,10,10,70,1
Style: 星-千-Nako-furigana,方正FW筑紫A圆 简 E,46,&H009158FB,&H009359EA,&H00FFFFFF,&H20BF99FF,0,0,0,0,100,100,0,0,1,4.5,4,2,10,10,70,1
Style: 星-千-Nako,方正FW筑紫A圆 简 E,92,&H009158FB,&H009359EA,&H00FFFFFF,&H20BF99FF,0,0,0,0,100,100,0,0,1,9,8,2,10,10,70,1
Style: 星-可可-鲤鱼,方正FW筑紫A圆 简 E,92,&H009CA601,&H00A1AC08,&H00FFFFFF,&H50EBF793,0,0,0,0,100,100,0,0,1,9,8,2,10,10,70,1
Style: 星-堇-Pay,方正FW筑紫A圆 简 E,92,&H0000AB39,&H001EAA4D,&H00FFFFFF,&H5093FF9E,0,0,0,0,100,100,0,0,1,9,8,2,10,10,70,1
Style: 星-恋-渚,方正FW筑紫A圆 简 E,92,&H00B9110A,&H00B62E21,&H00FFFFFF,&H00D26765,0,0,0,0,100,100,0,0,1,9,20,2,10,10,70,1
Style: 星-樱小路希奈子-铃原希实,方正FW筑紫A圆 简 E,92,&H00009FD4,&H000E95C1,&H00FFFFFF,&H0054C4D5,0,0,0,0,100,100,0,0,1,9,8,2,10,10,70,1
Style: 星-米女芽衣-薮岛朱音,方正FW筑紫A圆 简 E,92,&H003535FF,&H003535FF,&H00FFFFFF,&H207677FF,0,0,0,0,100,100,0,0,1,9,8,2,10,10,70,1
Style: 全局阴影,方正FW筑紫A圆 简 E,92,&H00FFFFFF,&H00FFFFFF,&H00FFFFFF,&H96727272,0,0,0,0,100,100,0,0,1,9,13,2,10,10,70,1
Style: Default,Arial,48,&H00FFFFFF,&H000000FF,&H00000000,&H00000000,0,0,0,0,100,100,0,0,1,2,2,2,10,10,10,1
Style: 虹-岚珠-菜宝,方正FW筑紫A圆 简 E,92,&H00656DFF,&H00737AFE,&H00FFFFFF,&H00B8B7EE,0,0,0,0,100,100,0,0,1,9,8,2,10,10,60,1
Style: 虹-果林-miyu碳,方正FW筑紫A圆 简 E,92,&H00C65E48,&H00C65E48,&H00FFFFFF,&H00FAA275,0,0,0,0,100,100,0,0,1,9,8,2,10,10,70,1
Style: 虹-栞子-萌P,方正FW筑紫A圆 简 E,92,&H007DAB34,&H006FA51D,&H00FFFFFF,&H0083CD70,0,0,0,0,100,100,0,0,1,9,8,2,10,10,70,1
Style: 虹-步梦-阿兔嘭,方正FW筑紫A圆 简 E,92,&H008A53FC,&H008A53FC,&H00FFFFFF,&H009994FF,0,0,0,0,100,100,0,0,1,9,8,2,10,10,70,1
Style: 虹-爱-奈酱,方正FW筑紫A圆 简 E,92,&H000058FF,&H000058FF,&H00FFFFFF,&H008D8DFF,0,0,0,0,100,100,0,0,1,9,8,2,10,10,70,1

[Events]
Format: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text
Comment: 0,0:00:00.00,0:00:00.00,Default,,0,0,0,code once,local function getSpecificVar(targetName) local level = 1 while _G.debug.getinfo(level) ~= nil do local i = 1 while true do local name, value = _G.debug.getlocal(level, i) if name == targetName then return value elseif name == nil then break end i = i + 1 end level = level + 1 end return nil end --[[ 通过 subs 字段获取当前字幕内容（但是获取不到 Format: 行，反正这玩意也没人认） ]] local function getSubtitleContent() local assFile = {} local hasSection = {} local playResX = 0 local playResY = 0 local currSubs = getSpecificVar('subs') for i = 1, #currSubs do local sub = currSubs[i] if sub.key == 'PlayResX' then playResX = _G.tonumber(sub.value) elseif sub.key == 'PlayResY' then playResY = _G.tonumber(sub.value) end local section = sub.section if not hasSection[section] then _G.table.insert(assFile, '\n' .. section) hasSection[section] = true end local toInsert = sub.raw --[[ 把符合 kara-templater 匹配模板条件的 Comment 替换成 Dialogue ]] if sub.class == "dialogue" and sub.comment == true and sub.effect:match("[Kk]araoke") then toInsert = _G.string.gsub(toInsert, 'Comment: ', 'Dialogue: ', 1) end _G.table.insert(assFile, toInsert) end if playResX == 0 or playResY == 0 then playResX, playResY = _G.aegisub.video_size() end return _G.table.concat(assFile, '\n'), playResX, playResY end local function getPosWithAccupos(assText, playResX, playResY) local ffi = _G.require('ffi') ffi.cdef([[ void *accupos_init(int32_t width, int32_t height, const char *ass_data, int32_t ass_data_len); void accupos_done(void *lib); int32_t accupos_get_dialogue_num(void *lib); const char *accupos_get_ith_raw(void *lib, int32_t i); int32_t accupos_get_ith_pos_x(void *lib, int32_t i); int32_t accupos_get_ith_pos_y(void *lib, int32_t i); int32_t accupos_get_ith_width(void *lib, int32_t i); int32_t accupos_get_ith_height(void *lib, int32_t i); ]]) local lib = ffi.load(_G.jit.arch == 'x64' and 'accupos64' or 'accupos32') local voidptr = lib.accupos_init(playResX, playResY, assText, #assText) local result = {} local dialogue_num = lib.accupos_get_dialogue_num(voidptr) if dialogue_num < 0 then _G.error('代码出错：accupos 库返回 Dialogue 数量为 -1，这表明初始化出错。') end for i = 1, dialogue_num do local d = { raw = ffi.string(lib.accupos_get_ith_raw(voidptr, i - 1)), pos_x = lib.accupos_get_ith_pos_x(voidptr, i - 1), pos_y = lib.accupos_get_ith_pos_y(voidptr, i - 1), width = lib.accupos_get_ith_width(voidptr, i - 1), height = lib.accupos_get_ith_height(voidptr, i - 1), } if d.width > 0 and d.height > 0 then _G.table.insert(result, d) end end lib.accupos_done(voidptr) return result end local function dump(o) if _G.type(o) == 'table' then local s = '{ ' for k, v in _G.pairs(o) do if _G.type(k) ~= 'number' then k = '"' .. k .. '"' end s = s .. '[' .. k .. '] = ' .. dump(v) .. ',' end return s .. '} ' else return _G.tostring(o) end end local assText, playResX, playResY = getSubtitleContent() local positions = getPosWithAccupos(assText, playResX, playResY) --[[ _G.error('\n\npositions = <'..dump(positions)..'>\n\n') ]] local globalCounter = 1 local lastIndex = -1 local function startsWith(str, pattern) return str:sub(1,#pattern) == pattern end function getPos(index) if orgline.text:gsub('^%s+$', '') == '' then return '' end --[[ _G.error(_G.string.format('\n\norgline.raw = <%s>\n\norgline.comment = <%s>\n\norgline.effect = <%s>\n\n', orgline.raw, orgline.comment, orgline.effect)) ]] if lastIndex ~= index then lastIndex = index local lineRaw = orgline.raw if startsWith(lineRaw, 'Comment: ') then lineRaw = _G.string.gsub(lineRaw, 'Comment: ', 'Dialogue: ', 1) end lineRaw = _G.string.gsub(lineRaw, '%s+$', '') while positions[globalCounter].raw ~= lineRaw do globalCounter = globalCounter + 1 if globalCounter > #positions then _G.error('代码出错：重建的字幕文件与实际字幕不匹配。') end end end local p = positions[globalCounter] return _G.string.format([[\pos(%d,%d)]], p.pos_x, p.pos_y) end function resetMargin() line.margin_l = 0 line.margin_r = 0 line.margin_t = 0 line.margin_b = 0 return '' end
Comment: 0,0:00:00.00,0:00:00.00,Default,,0,0,0,template line all keeptags,!resetMargin()!!relayer(0)!!restyle('全局阴影')!{!getPos(line.i)!\1a&HFF&\3a&HFF&}
Comment: 0,0:00:00.00,0:00:00.00,Default,,0,0,0,template line all keeptags,!resetMargin()!!relayer(1)!{!getPos(line.i)!\bord11.5\shad5.5\3c!_G.interpolate_color(0.8,'&HFFFFFF&',line.styleref.color2)!\1a&HFF&}
Comment: 0,0:00:00.00,0:00:00.00,Default,,0,0,0,template line all keeptags,!resetMargin()!!relayer(2)!{!getPos(line.i)!\shad0}
Comment: 0,0:00:00.00,0:00:05.00,星-恋-渚,,0,0,200,karaoke,{}我爱你，我的岬，我的岬，我的天堂 4(1)
Comment: 0,0:00:00.00,0:00:05.00,星-米女芽衣-薮岛朱音,,0,0,250,karaoke,{}我爱你，我的岬，我的岬，我的天堂 5(2)
Comment: 0,0:00:00.00,0:00:05.00,星-堇-Pay,,0,0,460,karaoke,{}我爱你，我的岬，我的岬，我的天堂 6(3)
Comment: 0,0:00:00.00,0:00:05.00,星-可可-鲤鱼,,0,0,0,karaoke,{\an8}wefewgreergrfw 8(5)
Comment: 0,0:00:00.00,0:00:05.00,Default,,0,0,0,karaoke,
Comment: 0,0:00:00.00,0:00:05.00,星-米女芽衣-薮岛朱音,,0,0,0,karaoke,{\an9}我爱你，我的岬，我的岬，我的天堂 9(6)
Comment: 0,0:00:00.00,0:00:05.00,虹-岚珠-菜宝,,0,0,0,karaoke,{\an6}我爱你，我的岬，我的岬，我的天堂 10(7)
Dialogue: 0,0:00:00.00,0:00:05.00,全局阴影,,0,0,0,fx,{\pos(959,880)\1a&HFF&\3a&HFF&}我爱你，我的岬，我的岬，我的天堂 4(1)
Dialogue: 1,0:00:00.00,0:00:05.00,星-恋-渚,,0,0,0,fx,{\pos(959,880)\bord11.5\shad5.5\3c&HC4574D&\1a&HFF&}我爱你，我的岬，我的岬，我的天堂 4(1)
Dialogue: 2,0:00:00.00,0:00:05.00,星-恋-渚,,0,0,0,fx,{\pos(959,880)\shad0}我爱你，我的岬，我的岬，我的天堂 4(1)
Dialogue: 0,0:00:00.00,0:00:05.00,全局阴影,,0,0,0,fx,{\pos(959,770)\1a&HFF&\3a&HFF&}我爱你，我的岬，我的岬，我的天堂 5(2)
Dialogue: 1,0:00:00.00,0:00:05.00,星-米女芽衣-薮岛朱音,,0,0,0,fx,{\pos(959,770)\bord11.5\shad5.5\3c&H5D5DFF&\1a&HFF&}我爱你，我的岬，我的岬，我的天堂 5(2)
Dialogue: 2,0:00:00.00,0:00:05.00,星-米女芽衣-薮岛朱音,,0,0,0,fx,{\pos(959,770)\shad0}我爱你，我的岬，我的岬，我的天堂 5(2)
Dialogue: 0,0:00:00.00,0:00:05.00,全局阴影,,0,0,0,fx,{\pos(959,620)\1a&HFF&\3a&HFF&}我爱你，我的岬，我的岬，我的天堂 6(3)
Dialogue: 1,0:00:00.00,0:00:05.00,星-堇-Pay,,0,0,0,fx,{\pos(959,620)\bord11.5\shad5.5\3c&H4BBB70&\1a&HFF&}我爱你，我的岬，我的岬，我的天堂 6(3)
Dialogue: 2,0:00:00.00,0:00:05.00,星-堇-Pay,,0,0,0,fx,{\pos(959,620)\shad0}我爱你，我的岬，我的岬，我的天堂 6(3)
Dialogue: 0,0:00:00.00,0:00:05.00,全局阴影,,0,0,0,fx,{\pos(960,70)\1a&HFF&\3a&HFF&}{\an8}wefewgreergrfw 8(5)
Dialogue: 1,0:00:00.00,0:00:05.00,星-可可-鲤鱼,,0,0,0,fx,{\pos(960,70)\bord11.5\shad5.5\3c&HB3BC39&\1a&HFF&}{\an8}wefewgreergrfw 8(5)
Dialogue: 2,0:00:00.00,0:00:05.00,星-可可-鲤鱼,,0,0,0,fx,{\pos(960,70)\shad0}{\an8}wefewgreergrfw 8(5)
Dialogue: 0,0:00:00.00,0:00:05.00,全局阴影,,0,0,0,fx,{\1a&HFF&\3a&HFF&}
Dialogue: 1,0:00:00.00,0:00:05.00,Default,,0,0,0,fx,{\bord11.5\shad5.5\3c&H3333FF&\1a&HFF&}
Dialogue: 2,0:00:00.00,0:00:05.00,Default,,0,0,0,fx,{\shad0}
Dialogue: 0,0:00:00.00,0:00:05.00,全局阴影,,0,0,0,fx,{\pos(1910,180)\1a&HFF&\3a&HFF&}{\an9}我爱你，我的岬，我的岬，我的天堂 9(6)
Dialogue: 1,0:00:00.00,0:00:05.00,星-米女芽衣-薮岛朱音,,0,0,0,fx,{\pos(1910,180)\bord11.5\shad5.5\3c&H5D5DFF&\1a&HFF&}{\an9}我爱你，我的岬，我的岬，我的天堂 9(6)
Dialogue: 2,0:00:00.00,0:00:05.00,星-米女芽衣-薮岛朱音,,0,0,0,fx,{\pos(1910,180)\shad0}{\an9}我爱你，我的岬，我的岬，我的天堂 9(6)
Dialogue: 0,0:00:00.00,0:00:05.00,全局阴影,,0,0,0,fx,{\pos(1910,944)\1a&HFF&\3a&HFF&}{\an6}我爱你，我的岬，我的岬，我的天堂 10(7)
Dialogue: 1,0:00:00.00,0:00:05.00,虹-岚珠-菜宝,,0,0,0,fx,{\pos(1910,944)\bord11.5\shad5.5\3c&H8F94FE&\1a&HFF&}{\an6}我爱你，我的岬，我的岬，我的天堂 10(7)
Dialogue: 2,0:00:00.00,0:00:05.00,虹-岚珠-菜宝,,0,0,0,fx,{\pos(1910,944)\shad0}{\an6}我爱你，我的岬，我的岬，我的天堂 10(7)
