[Script Info]
; Script generated by Aegisub 9215, Daydream Cafe Edition [Shinon]
; http://www.aegisub.org/
Title: Default Aegisub file
ScriptType: v4.00+
WrapStyle: 0
ScaledBorderAndShadow: yes
YCbCr Matrix: TV.709
PlayResX: 1920
PlayResY: 1080

[Aegisub Project Garbage]
Last Style Storage: ipid-我的样式-v3
Audio File: D:/code/subtitle/230129-liella-live/压字幕源-鲤鱼选妃.mp4
Video File: D:/code/subtitle/230129-liella-live/压字幕源-鲤鱼选妃.mp4
Video AR Mode: 4
Video AR Value: 1.777778
Video Zoom Percent: 0.500000
Active Line: 7
Video Position: 101

[V4+ Styles]
Format: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding
Style: Default,Arial,48,&H00FFFFFF,&H000000FF,&H00000000,&H00000000,0,0,0,0,100,100,0,0,1,2,2,2,10,10,10,1
Style: 星-全员,方正FW筑紫A圆 简 E,92,&H009B46A5,&H008B2C97,&H00FFFFFF,&H20AE6393,0,0,0,0,100,100,0,0,1,9,8,2,10,10,70,1
Style: 星-可可-鲤鱼,方正FW筑紫A圆 简 E,92,&H009CA601,&H00A1AC08,&H00FFFFFF,&H50EBF793,0,0,0,0,100,100,0,0,1,9,8,2,10,10,70,1
Style: 星-香音-Sayu,方正FW筑紫A圆 简 E,92,&H001573FF,&H001573FF,&H00FFFFFF,&H2079AFFF,0,0,0,0,100,100,0,0,1,9,7.1,2,10,10,70,1
Style: 星-堇-Pay,方正FW筑紫A圆 简 E,92,&H0000AB39,&H001EAA4D,&H00FFFFFF,&H5093FF9E,0,0,0,0,100,100,0,0,1,9,8,2,10,10,70,1
Style: 全局阴影,方正FW筑紫A圆 简 E,92,&H00FFFFFF,&H00FFFFFF,&H00FFFFFF,&H96727272,0,0,0,0,100,100,0,0,1,9,13,2,10,10,70,1

[Events]
Format: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text
Comment: 0,0:00:00.00,0:00:00.01,Default,,0,0,0,code once, --[[ 颜色参数：第二层描边大小、不透明度 ]] EB_WIDTH = 2.5 ; EB_OPACITY = 1 ; EB_BLEND_WHITE = 0.8
Comment: 0,0:00:00.00,0:00:00.01,Default,,0,0,0,code once, --[[ 排版参数：每行的高度、底部的间距 ]] LINE_HEIGHT = 108 ;  MARGIN_BOTTOM = 70
Comment: 0,0:00:00.00,0:00:00.01,Default,,0,0,0,code once,--[[ 代码：计算每行轴所在位置 ]] local util = _G.require('aegisub.util') ipid = {} if _G.aegisub.frame_from_ms(0) == nil then _G.aegisub.dialog.display({ { class = "label", label = "【错误】\n\n本卡拉 OK 模板必须在打开视频之后才能运行。\n请打开一个视频后再运行本卡拉 OK 模板。\n如果没有视频，请点击「视频」→「使用空白视频」。\n", x = 0, y = 0 } }, { '好的，我现在就去打开视频' }) _G.error() end local function getSpecificVar(targetName) local level = 1 while _G.debug.getinfo(level) ~= nil do local i = 1 while true do local name, value = _G.debug.getlocal(level, i) if name == targetName then return value elseif name == nil then break end i = i + 1 end level = level + 1 end return nil end local function shouldProcessLine(l) --[[ 此处的判断逻辑与 kara-templater.lua 保持一致， 请参考原版中的 apply_templates 函数 ]] return _G.type(l.start_time) == 'number' and _G.type(l.end_time) == 'number' and _G.type(l.text) == 'string' and _G.type(l.style) == 'string' and _G.type(l.effect) == 'string' and _G.type(l.comment) == 'boolean' and ((l.effect == '' and l.comment == false) or l.effect == 'karaoke' or l.effect == 'Karaoke') end local function getAllDialogueLines() local theSubs = getSpecificVar('subs') local theStyles = getSpecificVar('styles') local output = {} for i = 1, #theSubs do local l = theSubs[i] if shouldProcessLine(l) then local startFrame = _G.aegisub.frame_from_ms(l.start_time) local endFrame = _G.aegisub.frame_from_ms(l.end_time) - 1 local text = l.text:gsub('%s+', '') local skip = false if theStyles[l.style].align ~= 2 or text:find('\\pos') ~= nil or text:find('\\move') ~= nil or text:find('\\an') ~= nil or util.trim(text) == '' then --[[ 仍然需要处理，但是分配到的 slot 为 -1，且跳过碰撞检测 ]] skip = true end if startFrame <= endFrame then output[#output + 1] = { index = i, startFrame = startFrame, endFrame = endFrame, skip = skip, } end end end return output end local function getLineToSlotTable(allLines) local events = {} for i = 1, #allLines do local l = allLines[i] events[#events + 1] = { index = l.index, type = 1, frame = l.startFrame, skip = l.skip, } if not l.skip then events[#events + 1] = { index = l.index, type = 0, frame = l.endFrame + 1, skip = l.skip, } end end local function sortEvents(a, b) if a.frame ~= b.frame then return a.frame < b.frame elseif a.type ~= b.type then return a.type < b.type end return a.index < b.index end _G.table.sort(events, sortEvents) local lineToSlot = {} local slots = {} for i = 1, #events do local ev = events[i] if ev.type == 0 then local targetSlot = lineToSlot[ev.index] slots[targetSlot] = nil else if ev.skip then lineToSlot[ev.index] = -1 else local targetSlot = 1 while slots[targetSlot] ~= nil do targetSlot = targetSlot + 1 end slots[targetSlot] = true lineToSlot[ev.index] = targetSlot end end end return lineToSlot end function ipid.convertSlotToPos(lineToSlot) local theMeta = getSpecificVar('meta') local output = {} for index, slot in _G.pairs(lineToSlot) do if slot < 0 then output[index] = '' else local x = _G.math.floor(theMeta.res_x / 2) local y = theMeta.res_y - MARGIN_BOTTOM - (slot - 1) * LINE_HEIGHT output[index] = _G.string.format('{\\pos(%d,%d)}', x, y) end end return output end linePos = ipid.convertSlotToPos(getLineToSlotTable(getAllDialogueLines()))
Comment: 0,0:00:00.00,0:00:00.01,Default,,0,0,0,template line all keeptags,!relayer(0)!!linePos[$i]!!restyle('全局阴影')!{\1a&HFF&\3a&HFF&}
Comment: 0,0:00:00.00,0:00:00.01,Default,,0,0,0,template line all keeptags,!relayer(1)!!linePos[$i]!{\bord!line.styleref.outline + EB_WIDTH!\shad!line.styleref.shadow - EB_WIDTH!\3c!_G.interpolate_color(EB_BLEND_WHITE,'&HFFFFFF&',line.styleref.color2)!\3a&H!_G.string.format('%02X',(1-EB_OPACITY)*255)!&\1a&HFF&}
Comment: 0,0:00:00.00,0:00:00.01,Default,,0,0,0,template line all keeptags,!relayer(2)!!linePos[$i]!{\shad0}
Comment: 0,0:00:01.21,0:00:02.89,星-可可-鲤鱼,,0,0,0,karaoke,啊啊 声音好听的人？
Comment: 0,0:00:03.45,0:00:05.02,星-堇-Pay,,0,0,0,karaoke,{\fad(300,300)\pos(310,150)\frz354.5}（抢镜 Pay）
Comment: 0,0:00:13.08,0:00:14.17,星-可可-鲤鱼,,0,0,0,karaoke,呜哇！
Comment: 0,0:00:19.97,0:00:21.67,星-香音-Sayu,,0,0,0,karaoke,你笑什么呢？
Comment: 0,0:00:21.67,0:00:22.96,星-香音-Sayu,,0,0,0,karaoke,你笑什么笑
Comment: 0,0:00:24.17,0:00:25.55,星-堇-Pay,,0,0,0,karaoke,什么都没有说啊
Comment: 0,0:00:26.33,0:00:29.91,星-全员,,0,0,0,karaoke,声音好听的人！
Comment: 0,0:00:29.91,0:00:32.60,星-可可-鲤鱼,,0,0,0,karaoke,谢谢大家
Comment: 0,0:00:32.60,0:00:35.25,星-可可-鲤鱼,,0,0,0,karaoke,我是饰演唐可可 昵称鲤酱的Liyuu ......
Dialogue: 0,0:00:01.21,0:00:02.89,全局阴影,,0,0,0,fx,{\pos(960,1010)}{\1a&HFF&\3a&HFF&}啊啊 声音好听的人？
Dialogue: 1,0:00:01.21,0:00:02.89,星-可可-鲤鱼,,0,0,0,fx,{\pos(960,1010)}{\bord11.5\shad5.5\3c&HB3BC39&\3a&H00&\1a&HFF&}啊啊 声音好听的人？
Dialogue: 2,0:00:01.21,0:00:02.89,星-可可-鲤鱼,,0,0,0,fx,{\pos(960,1010)}{\shad0}啊啊 声音好听的人？
Dialogue: 0,0:00:03.45,0:00:05.02,全局阴影,,0,0,0,fx,{\1a&HFF&\3a&HFF&}{\fad(300,300)\pos(310,150)\frz354.5}（抢镜 Pay）
Dialogue: 1,0:00:03.45,0:00:05.02,星-堇-Pay,,0,0,0,fx,{\bord11.5\shad5.5\3c&H4BBB70&\3a&H00&\1a&HFF&}{\fad(300,300)\pos(310,150)\frz354.5}（抢镜 Pay）
Dialogue: 2,0:00:03.45,0:00:05.02,星-堇-Pay,,0,0,0,fx,{\shad0}{\fad(300,300)\pos(310,150)\frz354.5}（抢镜 Pay）
Dialogue: 0,0:00:13.08,0:00:14.17,全局阴影,,0,0,0,fx,{\pos(960,1010)}{\1a&HFF&\3a&HFF&}呜哇！
Dialogue: 1,0:00:13.08,0:00:14.17,星-可可-鲤鱼,,0,0,0,fx,{\pos(960,1010)}{\bord11.5\shad5.5\3c&HB3BC39&\3a&H00&\1a&HFF&}呜哇！
Dialogue: 2,0:00:13.08,0:00:14.17,星-可可-鲤鱼,,0,0,0,fx,{\pos(960,1010)}{\shad0}呜哇！
Dialogue: 0,0:00:19.97,0:00:21.67,全局阴影,,0,0,0,fx,{\pos(960,1010)}{\1a&HFF&\3a&HFF&}你笑什么呢？
Dialogue: 1,0:00:19.97,0:00:21.67,星-香音-Sayu,,0,0,0,fx,{\pos(960,1010)}{\bord11.5\shad4.6\3c&H438FFF&\3a&H00&\1a&HFF&}你笑什么呢？
Dialogue: 2,0:00:19.97,0:00:21.67,星-香音-Sayu,,0,0,0,fx,{\pos(960,1010)}{\shad0}你笑什么呢？
Dialogue: 0,0:00:21.67,0:00:22.96,全局阴影,,0,0,0,fx,{\pos(960,1010)}{\1a&HFF&\3a&HFF&}你笑什么笑
Dialogue: 1,0:00:21.67,0:00:22.96,星-香音-Sayu,,0,0,0,fx,{\pos(960,1010)}{\bord11.5\shad4.6\3c&H438FFF&\3a&H00&\1a&HFF&}你笑什么笑
Dialogue: 2,0:00:21.67,0:00:22.96,星-香音-Sayu,,0,0,0,fx,{\pos(960,1010)}{\shad0}你笑什么笑
Dialogue: 0,0:00:24.17,0:00:25.55,全局阴影,,0,0,0,fx,{\pos(960,1010)}{\1a&HFF&\3a&HFF&}什么都没有说啊
Dialogue: 1,0:00:24.17,0:00:25.55,星-堇-Pay,,0,0,0,fx,{\pos(960,1010)}{\bord11.5\shad5.5\3c&H4BBB70&\3a&H00&\1a&HFF&}什么都没有说啊
Dialogue: 2,0:00:24.17,0:00:25.55,星-堇-Pay,,0,0,0,fx,{\pos(960,1010)}{\shad0}什么都没有说啊
Dialogue: 0,0:00:26.33,0:00:29.91,全局阴影,,0,0,0,fx,{\pos(960,1010)}{\1a&HFF&\3a&HFF&}声音好听的人！
Dialogue: 1,0:00:26.33,0:00:29.91,星-全员,,0,0,0,fx,{\pos(960,1010)}{\bord11.5\shad5.5\3c&HA256AB&\3a&H00&\1a&HFF&}声音好听的人！
Dialogue: 2,0:00:26.33,0:00:29.91,星-全员,,0,0,0,fx,{\pos(960,1010)}{\shad0}声音好听的人！
Dialogue: 0,0:00:29.91,0:00:32.60,全局阴影,,0,0,0,fx,{\pos(960,1010)}{\1a&HFF&\3a&HFF&}谢谢大家
Dialogue: 1,0:00:29.91,0:00:32.60,星-可可-鲤鱼,,0,0,0,fx,{\pos(960,1010)}{\bord11.5\shad5.5\3c&HB3BC39&\3a&H00&\1a&HFF&}谢谢大家
Dialogue: 2,0:00:29.91,0:00:32.60,星-可可-鲤鱼,,0,0,0,fx,{\pos(960,1010)}{\shad0}谢谢大家
Dialogue: 0,0:00:32.60,0:00:35.25,全局阴影,,0,0,0,fx,{\pos(960,1010)}{\1a&HFF&\3a&HFF&}我是饰演唐可可 昵称鲤酱的Liyuu ......
Dialogue: 1,0:00:32.60,0:00:35.25,星-可可-鲤鱼,,0,0,0,fx,{\pos(960,1010)}{\bord11.5\shad5.5\3c&HB3BC39&\3a&H00&\1a&HFF&}我是饰演唐可可 昵称鲤酱的Liyuu ......
Dialogue: 2,0:00:32.60,0:00:35.25,星-可可-鲤鱼,,0,0,0,fx,{\pos(960,1010)}{\shad0}我是饰演唐可可 昵称鲤酱的Liyuu ......
